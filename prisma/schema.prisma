generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/* =======================
   ENUMS
======================= */

/*
  AMAZON ‚Üí fonte ativa e p√∫blica
  MERCADO_LIVRE ‚Üí mantido apenas internamente
*/
enum Store {
  AMAZON
  MERCADO_LIVRE
}

enum CreatineForm {
  POWDER
  CAPSULE
  GUMMY
}

/* =======================
   PRODUCT
======================= */
model Product {
  id             String        @id @default(cuid())

  category       String
  name           String
  brand          String
  flavor         String?
  imageUrl       String

  // Dados espec√≠ficos da creatina
  creatineInfo   CreatineInfo?

  // Dados espec√≠ficos do whey
  wheyInfo       WheyInfo?

  // Dados espec√≠ficos da barra de prote√≠na
  proteinBarInfo ProteinBarInfo?

  // Ofertas por loja
  offers         Offer[]

  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
}

/* =======================
   CREATINE INFO
======================= */
model CreatineInfo {
  id           String       @id @default(cuid())
  productId    String       @unique
  product      Product      @relation(fields: [productId], references: [id], onDelete: Cascade)

  form         CreatineForm
  totalUnits   Float
  unitsPerDose Float

  @@index([form])
}

/* =======================
   WHEY INFO
======================= */
model WheyInfo {
  id                    String  @id @default(cuid())
  productId             String  @unique
  product               Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  totalWeightInGrams    Float
  doseInGrams           Float
  proteinPerDoseInGrams Float
}

/* =======================
   PROTEIN BAR INFO
   (Ajustado: Unidades em vez de Peso Total)
======================= */
model ProteinBarInfo {
  id                    String  @id @default(cuid())
  productId             String  @unique
  product               Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  unitsPerBox           Int     // Unidades por caixa (Ex: 12)
  doseInGrams           Float   // Peso de uma unidade (barrinha)
  proteinPerDoseInGrams Float   // Prote√≠na por unidade
}

/* =======================
   OFFER
======================= */
model Offer {
  id            String   @id @default(cuid())

  productId     String
  product       Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  store         Store
  externalId    String

  price         Float
  affiliateUrl  String

  ratingAverage Float?
  ratingCount   Int?

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // üîó Hist√≥rico de pre√ßos
  priceHistory  OfferPriceHistory[]

  @@unique([store, externalId])
  @@index([productId])
  @@index([store])
}

/* =======================
   OFFER PRICE HISTORY
   (NOVO ‚Äì HIST√ìRICO REAL)
======================= */
model OfferPriceHistory {
  id        String   @id @default(cuid())

  offerId   String
  offer     Offer    @relation(fields: [offerId], references: [id], onDelete: Cascade)

  price     Float
  createdAt DateTime @default(now())

  @@index([offerId, createdAt])
}

/* =======================
   AMAZON IMPORT QUEUE
======================= */
model AmazonImportQueue {
  id        String   @id @default(cuid())
  asin      String
  createdAt DateTime @default(now())

  @@unique([asin])
}