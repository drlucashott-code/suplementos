generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id       String   @id @default(cuid())
  category String
  name     String
  brand    String
  flavor   String?
  imageUrl String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  offers               Offer[]
  creatineInfo         CreatineInfo?
  wheyInfo             WheyInfo?
  proteinBarInfo       ProteinBarInfo?
  proteinDrinkInfo     ProteinDrinkInfo?
  functionalCoffeeInfo FunctionalCoffeeInfo?
  preWorkoutInfo       PreWorkoutInfo?       
}

model CreatineInfo {
  id           String       @id @default(cuid())
  productId    String       @unique
  form         CreatineForm
  totalUnits   Float
  unitsPerDose Float
  product      Product      @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([form])
}

model WheyInfo {
  id                    String  @id @default(cuid())
  productId             String  @unique
  totalWeightInGrams    Float
  doseInGrams           Float
  proteinPerDoseInGrams Float
  product               Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model ProteinBarInfo {
  id                    String  @id @default(cuid())
  productId             String  @unique
  doseInGrams           Float
  proteinPerDoseInGrams Float
  unitsPerBox           Int
  product               Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model ProteinDrinkInfo {
  id                    String  @id @default(cuid())
  productId             String  @unique
  unitsPerPack          Int
  volumePerUnitInMl     Float
  proteinPerUnitInGrams Float
  product               Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model FunctionalCoffeeInfo {
  id          String  @id @default(cuid())
  productId   String  @unique
  product     Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  totalWeight Float
  doseWeight  Float
  caffeine    Float
}

// --- MODELO ATUALIZADO (PADRÃO WHEY) ---
model PreWorkoutInfo {
  id                  String  @id @default(cuid())
  productId           String  @unique
  totalWeightInGrams  Float   // Peso total do pote (ex: 300g)
  doseInGrams         Float   // Tamanho do scoop (ex: 10g)
  caffeinePerDoseInMg Float   // Cafeína por dose (ex: 200mg)
  product             Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model Offer {
  id            String            @id @default(cuid())
  productId     String
  store         Store
  externalId    String
  seller        String?           // Campo adicionado para o filtro "Vendido por"
  price         Float
  affiliateUrl  String
  createdAt     DateTime          @default(now())
  ratingAverage Float?
  ratingCount   Int?
  updatedAt     DateTime          @updatedAt
  product       Product           @relation(fields: [productId], references: [id], onDelete: Cascade)
  priceHistory  OfferPriceHistory[]

  @@unique([store, externalId])
  @@index([productId])
  @@index([store])
}

model OfferPriceHistory {
  id        String   @id @default(cuid())
  offerId   String
  price     Float
  createdAt DateTime @default(now())
  offer     Offer    @relation(fields: [offerId], references: [id], onDelete: Cascade)

  @@index([offerId, createdAt])
}

model AmazonImportQueue {
  id        String   @id @default(cuid())
  asin      String   @unique
  createdAt DateTime @default(now())
}

enum Store {
  AMAZON
  MERCADO_LIVRE
}

enum CreatineForm {
  POWDER
  CAPSULE
  GUMMY
}