generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/* =======================
   ENUMS
======================= */

/*
  AMAZON → fonte ativa e pública
  MERCADO_LIVRE → mantido apenas internamente
  (estrutura preservada para possível retomada futura)
*/
enum Store {
  AMAZON
  MERCADO_LIVRE
}

enum CreatineForm {
  POWDER
  CAPSULE
  GUMMY
}

/* =======================
   PRODUCT
======================= */
model Product {
  id           String   @id @default(cuid())

  category     String
  name         String
  brand        String
  flavor       String?
  imageUrl     String

  // Dados específicos da creatina (quando aplicável)
  creatineInfo CreatineInfo?

  // Ofertas por loja (atualmente apenas AMAZON é usada publicamente)
  offers       Offer[]

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

/* =======================
   CREATINE INFO
======================= */
model CreatineInfo {
  id           String       @id @default(cuid())
  productId    String       @unique
  product      Product      @relation(fields: [productId], references: [id], onDelete: Cascade)

  form         CreatineForm

  /*
    Unidade principal por tipo:
    - POWDER   → gramas
    - CAPSULE → cápsulas
    - GUMMY   → gummies
  */
  totalUnits   Float
  unitsPerDose Float

  @@index([form])
}

/* =======================
   OFFER
   (Amazon / Mercado Livre)
======================= */
model Offer {
  id           String   @id @default(cuid())

  productId    String
  product      Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  /*
    AMAZON → usada no frontend e rankings
    MERCADO_LIVRE → mantida apenas para histórico/futuro uso
  */
  store        Store

  // ASIN (Amazon) ou MLBxxxx (Mercado Livre)
  externalId   String

  price        Float
  affiliateUrl String

  /*
    Avaliações:
    - Atualmente relevantes apenas para Mercado Livre
    - Mantidas para compatibilidade futura
  */
  ratingAverage Float?
  ratingCount   Int?

  createdAt    DateTime @default(now())

  // ⚠️ Mantido default para evitar problemas em migrations
  updatedAt    DateTime @default(now())

  @@index([productId])
  @@index([store])
  @@unique([store, externalId])
}
